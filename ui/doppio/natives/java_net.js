'use strict';
var Doppio = require('../doppiojvm');
var logging = Doppio.Debug.Logging;
var util = Doppio.VM.Util;
var ThreadStatus = Doppio.VM.Enums.ThreadStatus;
var debug = logging.debug;
var host_lookup = {}, host_reverse_lookup = {}, next_host_address = 4026531840;
function websocket_status_to_message(status) {
    switch (status) {
    case 1000:
        return 'Normal closure';
    case 1001:
        return 'Endpoint is going away';
    case 1002:
        return 'WebSocket protocol error';
    case 1003:
        return 'Server received invalid data';
    }
    return 'Unknown status code or error';
}
function next_address() {
    next_host_address++;
    if (next_host_address > 4194304000) {
        logging.error('Out of addresses');
        next_host_address = 4026531840;
    }
    return next_host_address;
}
function pack_address(address) {
    var i, ret = 0;
    for (i = 3; i >= 0; i--) {
        ret |= address[i] & 255;
        ret <<= 8;
    }
    return ret;
}
function host_allocate_address(address) {
    var ret = next_address();
    host_lookup[ret] = address;
    host_reverse_lookup[address] = ret;
    return ret;
}
function socket_read_async(impl, b, offset, len, resume_cb) {
    var i, available = impl.$ws.rQlen(), trimmed_len = available < len ? available : len, read = impl.$ws.rQshiftBytes(trimmed_len);
    for (i = 0; i < trimmed_len; i++) {
        b.array[offset++] = read[i];
    }
    resume_cb(trimmed_len);
}
var java_net_Inet4Address = function () {
    function java_net_Inet4Address() {
    }
    java_net_Inet4Address['init()V'] = function (thread) {
    };
    return java_net_Inet4Address;
}();
var java_net_Inet4AddressImpl = function () {
    function java_net_Inet4AddressImpl() {
    }
    java_net_Inet4AddressImpl['getLocalHostName()Ljava/lang/String;'] = function (thread, javaThis) {
        return thread.getJVM().internString('localhost');
    };
    java_net_Inet4AddressImpl['lookupAllHostAddr(Ljava/lang/String;)[Ljava/net/InetAddress;'] = function (thread, javaThis, hostname) {
        var rv = util.newObject(thread, thread.getBsCl(), 'Ljava/net/Inet4Address;');
        rv['<init>(Ljava/lang/String;I)V'](thread, [
            hostname,
            host_allocate_address(hostname.toString())
        ], function (e) {
            if (e) {
                thread.throwException(e);
            } else {
                thread.asyncReturn(util.newArrayFromData(thread, thread.getBsCl(), '[Ljava/net/InetAddress;', [rv]));
            }
        });
    };
    java_net_Inet4AddressImpl['getHostByAddr([B)Ljava/lang/String;'] = function (thread, javaThis, addr) {
        var ret = host_reverse_lookup[pack_address(addr.array)];
        if (ret == null) {
            return null;
        }
        return util.initString(thread.getBsCl(), '' + ret);
    };
    java_net_Inet4AddressImpl['isReachable0([BI[BI)Z'] = function (thread, javaThis, arg0, arg1, arg2, arg3) {
        return false;
    };
    return java_net_Inet4AddressImpl;
}();
var java_net_Inet6Address = function () {
    function java_net_Inet6Address() {
    }
    java_net_Inet6Address['init()V'] = function (thread) {
    };
    return java_net_Inet6Address;
}();
var java_net_InetAddress = function () {
    function java_net_InetAddress() {
    }
    java_net_InetAddress['init()V'] = function (thread) {
    };
    return java_net_InetAddress;
}();
var java_net_InetAddressImplFactory = function () {
    function java_net_InetAddressImplFactory() {
    }
    java_net_InetAddressImplFactory['isIPv6Supported()Z'] = function (thread) {
        return false;
    };
    return java_net_InetAddressImplFactory;
}();
var java_net_PlainSocketImpl = function () {
    function java_net_PlainSocketImpl() {
    }
    java_net_PlainSocketImpl['socketCreate(Z)V'] = function (thread, javaThis, isServer) {
        if (!util.are_in_browser()) {
            thread.throwNewException('Ljava/io/IOException;', 'WebSockets are disabled');
        } else {
            var fd = javaThis['java/net/SocketImpl/fd'];
            fd['java/io/FileDescriptor/fd'] = 8374;
            javaThis.$ws = new Websock();
            javaThis.$is_shutdown = false;
        }
    };
    java_net_PlainSocketImpl['socketConnect(Ljava/net/InetAddress;II)V'] = function (thread, javaThis, address, port, timeout) {
        var i, holder = address['java/net/InetAddress/holder'], addy = holder['java/net/InetAddress$InetAddressHolder/address'], host = 'ws://';
        if (host_lookup[addy] == null) {
            for (i = 3; i >= 0; i--) {
                var shift = i * 8;
                host += '' + ((addy & 255 << shift) >>> shift) + '.';
            }
            host = host.substring(0, host.length - 1);
        } else {
            host += host_lookup[addy];
        }
        host += ':' + port;
        ;
        thread.setStatus(ThreadStatus.ASYNC_WAITING);
        var id = 0, clear_state = function () {
                window.clearTimeout(id);
                javaThis.$ws.on('open', function () {
                });
                javaThis.$ws.on('close', function () {
                });
                javaThis.$ws.on('error', function () {
                });
            }, error_cb = function (msg) {
                return function (e) {
                    clear_state();
                    thread.throwNewException('Ljava/io/IOException;', msg + ': ' + e);
                };
            }, close_cb = function (msg) {
                return function (e) {
                    clear_state();
                    thread.throwNewException('Ljava/io/IOException;', msg + ': ' + websocket_status_to_message(e.status));
                };
            };
        javaThis.$ws.on('open', function () {
            ;
            clear_state();
            thread.asyncReturn();
        });
        javaThis.$ws.on('close', close_cb('Connection failed! (Closed)'));
        if (timeout === 0) {
            timeout = 10000;
        }
        id = setTimeout(error_cb('Connection timeout!'), timeout);
        ;
        try {
            javaThis.$ws.open(host);
        } catch (err) {
            error_cb('Connection failed! (exception)')(err.message);
        }
    };
    java_net_PlainSocketImpl['socketBind(Ljava/net/InetAddress;I)V'] = function (thread, javaThis, arg0, arg1) {
        thread.throwNewException('Ljava/io/IOException;', 'WebSockets doesn\'t know how to bind');
    };
    java_net_PlainSocketImpl['socketListen(I)V'] = function (thread, javaThis, arg0) {
        thread.throwNewException('Ljava/io/IOException;', 'WebSockets doesn\'t know how to listen');
    };
    java_net_PlainSocketImpl['socketAccept(Ljava/net/SocketImpl;)V'] = function (thread, javaThis, arg0) {
        thread.throwNewException('Ljava/io/IOException;', 'WebSockets doesn\'t know how to accept');
    };
    java_net_PlainSocketImpl['socketAvailable()I'] = function (thread, javaThis) {
        thread.setStatus(ThreadStatus.ASYNC_WAITING);
        setImmediate(function () {
            thread.asyncReturn(javaThis.$ws.rQlen());
        });
    };
    java_net_PlainSocketImpl['socketClose0(Z)V'] = function (thread, javaThis, arg0) {
        javaThis.$ws.close();
    };
    java_net_PlainSocketImpl['socketShutdown(I)V'] = function (thread, javaThis, arg0) {
        javaThis.$is_shutdown = true;
    };
    java_net_PlainSocketImpl['initProto()V'] = function (thread) {
    };
    java_net_PlainSocketImpl['socketSetOption0(IZLjava/lang/Object;)V'] = function (thread, javaThis, arg0, arg1, arg2) {
    };
    java_net_PlainSocketImpl['socketGetOption(ILjava/lang/Object;)I'] = function (thread, javaThis, arg0, arg1) {
        return 0;
    };
    java_net_PlainSocketImpl['socketSendUrgentData(I)V'] = function (thread, javaThis, data) {
        javaThis.$ws.send(data);
    };
    return java_net_PlainSocketImpl;
}();
var java_net_SocketInputStream = function () {
    function java_net_SocketInputStream() {
    }
    java_net_SocketInputStream['socketRead0(Ljava/io/FileDescriptor;[BIII)I'] = function (thread, javaThis, fd, b, offset, len, timeout) {
        var impl = javaThis['java/net/SocketInputStream/impl'];
        if (impl.$is_shutdown === true) {
            thread.throwNewException('Ljava/io/IOException;', 'Socket is shutdown.');
        } else {
            thread.setStatus(ThreadStatus.ASYNC_WAITING);
            setTimeout(function () {
                socket_read_async(impl, b, offset, len, function (arg) {
                    thread.asyncReturn(arg);
                });
            }, timeout);
        }
    };
    java_net_SocketInputStream['init()V'] = function (thread) {
    };
    return java_net_SocketInputStream;
}();
var java_net_SocketOutputStream = function () {
    function java_net_SocketOutputStream() {
    }
    java_net_SocketOutputStream['socketWrite0(Ljava/io/FileDescriptor;[BII)V'] = function (thread, javaThis, fd, b, offset, len) {
        var impl = javaThis['java/net/SocketOutputStream/impl'];
        if (impl.$is_shutdown === true) {
            thread.throwNewException('Ljava/io/IOException;', 'Socket is shutdown.');
        } else if (impl.$ws.get_raw_state() !== WebSocket.OPEN) {
            thread.throwNewException('Ljava/io/IOException;', 'Connection isn\'t open');
        } else {
            impl.$ws.send(b.array.slice(offset, offset + len));
            thread.setStatus(ThreadStatus.ASYNC_WAITING);
            setImmediate(function () {
                thread.asyncReturn();
            });
        }
    };
    java_net_SocketOutputStream['init()V'] = function (thread) {
    };
    return java_net_SocketOutputStream;
}();
var java_net_NetworkInterface = function () {
    function java_net_NetworkInterface() {
    }
    java_net_NetworkInterface['init()V'] = function (thread) {
    };
    java_net_NetworkInterface['getAll()[Ljava/net/NetworkInterface;'] = function (thread) {
        var bsCl = thread.getBsCl();
        thread.import([
            'Ljava/net/NetworkInterface;',
            'Ljava/net/InetAddress;'
        ], function (rv) {
            var niCons = rv[0], inetStatics = rv[1], iName = thread.getJVM().internString('doppio1');
            inetStatics['getByAddress(Ljava/lang/String;[B)Ljava/net/InetAddress;'](thread, [
                iName,
                util.newArrayFromData(thread, thread.getBsCl(), '[B', [
                    127,
                    1,
                    1,
                    1
                ])
            ], function (e, rv) {
                if (e) {
                    thread.throwException(e);
                } else {
                    var niObj = new niCons(thread);
                    niObj['<init>(Ljava/lang/String;I[Ljava/net/InetAddress;)V'](thread, [
                        iName,
                        0,
                        util.newArrayFromData(thread, bsCl, '[Ljava/net/InetAddress;', [rv])
                    ], function (e) {
                        if (e) {
                            thread.throwException(e);
                        } else {
                            thread.asyncReturn(util.newArrayFromData(thread, bsCl, '[Ljava/net/NetworkInterface;', [niObj]));
                        }
                    });
                }
            });
        });
    };
    java_net_NetworkInterface['getMacAddr0([BLjava/lang/String;I)[B'] = function (thread, inAddr, name, ind) {
        return util.newArrayFromData(thread, thread.getBsCl(), '[B', [
            1,
            1,
            1,
            1,
            1,
            1
        ]);
    };
    return java_net_NetworkInterface;
}();
registerNatives({
    'java/net/Inet4Address': java_net_Inet4Address,
    'java/net/Inet4AddressImpl': java_net_Inet4AddressImpl,
    'java/net/Inet6Address': java_net_Inet6Address,
    'java/net/InetAddress': java_net_InetAddress,
    'java/net/InetAddressImplFactory': java_net_InetAddressImplFactory,
    'java/net/PlainSocketImpl': java_net_PlainSocketImpl,
    'java/net/SocketInputStream': java_net_SocketInputStream,
    'java/net/SocketOutputStream': java_net_SocketOutputStream,
    'java/net/NetworkInterface': java_net_NetworkInterface
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9uYXRpdmVzL2phdmFfbmV0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxJQUFZLE1BQUEsR0FBTSxPQUFBLENBQU0sY0FBTixDQUFsQjtBQUlBLElBQU8sT0FBQSxHQUFVLE1BQUEsQ0FBTyxLQUFQLENBQWEsT0FBOUI7QUFDQSxJQUFPLElBQUEsR0FBTyxNQUFBLENBQU8sRUFBUCxDQUFVLElBQXhCO0FBQ0EsSUFBTyxZQUFBLEdBQWUsTUFBQSxDQUFPLEVBQVAsQ0FBVSxLQUFWLENBQWdCLFlBQXRDO0FBQ0EsSUFBTyxLQUFBLEdBQVEsT0FBQSxDQUFRLEtBQXZCO0FBeUJBLElBQUksV0FBQSxHQUF3QyxFQUE1QyxFQUNFLG1CQUFBLEdBQXFELEVBRHZELEVBR0UsaUJBQUEsR0FBb0IsVUFIdEI7QUFNQSxTQUFBLDJCQUFBLENBQXFDLE1BQXJDLEVBQW1EO0FBQUEsSUFDakQsUUFBUSxNQUFSO0FBQUEsSUFDRSxLQUFLLElBQUw7QUFBQSxRQUNFLE9BQU8sZ0JBQVAsQ0FGSjtBQUFBLElBR0UsS0FBSyxJQUFMO0FBQUEsUUFDRSxPQUFPLHdCQUFQLENBSko7QUFBQSxJQUtFLEtBQUssSUFBTDtBQUFBLFFBQ0UsT0FBTywwQkFBUCxDQU5KO0FBQUEsSUFPRSxLQUFLLElBQUw7QUFBQSxRQUNFLE9BQU8sOEJBQVAsQ0FSSjtBQUFBLEtBRGlEO0FBQUEsSUFXakQsT0FBTyw4QkFBUCxDQVhpRDtBQUFBO0FBY25ELFNBQUEsWUFBQSxHQUFBO0FBQUEsSUFDRSxpQkFBQSxHQURGO0FBQUEsSUFFRSxJQUFJLGlCQUFBLEdBQW9CLFVBQXhCLEVBQW9DO0FBQUEsUUFDbEMsT0FBQSxDQUFRLEtBQVIsQ0FBYyxrQkFBZCxFQURrQztBQUFBLFFBRWxDLGlCQUFBLEdBQW9CLFVBQXBCLENBRmtDO0FBQUEsS0FGdEM7QUFBQSxJQU1FLE9BQU8saUJBQVAsQ0FORjtBQUFBO0FBU0EsU0FBQSxZQUFBLENBQXNCLE9BQXRCLEVB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S0FBRCxDQUF4RyxDQUFuQixFQURLO0FBQUEseUJBSDhNO0FBQUEscUJBQXZOLEVBRks7QUFBQSxpQkFIbUo7QUFBQSxhQUQ1SixFQUh1SztBQUFBLFNBQXpLLEVBSG9FO0FBQUEsS0FBeEQsQ0FMaEI7QUFBQSxJQTZCZ0IseUJBQUEsQ0FBQSxzQ0FBQSxJQUFkLFVBQXFELE1BQXJELEVBQXdFLE1BQXhFLEVBQTJHLElBQTNHLEVBQTRJLEdBQTVJLEVBQXVKO0FBQUEsUUFDckosT0FBTyxJQUFBLENBQUssZ0JBQUwsQ0FBOEIsTUFBOUIsRUFBc0MsTUFBQSxDQUFPLE9BQVAsRUFBdEMsRUFBd0QsSUFBeEQsRUFBOEQ7QUFBQSxZQUFDLENBQUQ7QUFBQSxZQUFHLENBQUg7QUFBQSxZQUFLLENBQUw7QUFBQSxZQUFPLENBQVA7QUFBQSxZQUFTLENBQVQ7QUFBQSxZQUFXLENBQVg7QUFBQSxTQUE5RCxDQUFQLENBRHFKO0FBQUEsS0FBekksQ0E3QmhCO0FBQUEsSUFnQ0EsT0FBQSx5QkFBQSxDQWhDQTtBQUFBLENBQUEsRUFBQTtBQWtDQSxlQUFBLENBQWdCO0FBQUEsSUFDZCx5QkFBeUIscUJBRFg7QUFBQSxJQUVkLDZCQUE2Qix5QkFGZjtBQUFBLElBR2QseUJBQXlCLHFCQUhYO0FBQUEsSUFJZCx3QkFBd0Isb0JBSlY7QUFBQSxJQUtkLG1DQUFtQywrQkFMckI7QUFBQSxJQU1kLDRCQUE0Qix3QkFOZDtBQUFBLElBT2QsOEJBQThCLDBCQVBoQjtBQUFBLElBUWQsK0JBQStCLDJCQVJqQjtBQUFBLElBU2QsNkJBQTZCLHlCQVRmO0FBQUEsQ0FBaEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBEb3BwaW8gZnJvbSAnLi4vZG9wcGlvanZtJztcbmltcG9ydCBKVk1UaHJlYWQgPSBEb3BwaW8uVk0uVGhyZWFkaW5nLkpWTVRocmVhZDtcbmltcG9ydCBSZWZlcmVuY2VDbGFzc0RhdGEgPSBEb3BwaW8uVk0uQ2xhc3NGaWxlLlJlZmVyZW5jZUNsYXNzRGF0YTtcbmltcG9ydCBJSlZNQ29uc3RydWN0b3IgPSBEb3BwaW8uVk0uQ2xhc3NGaWxlLklKVk1Db25zdHJ1Y3RvcjtcbmltcG9ydCBsb2dnaW5nID0gRG9wcGlvLkRlYnVnLkxvZ2dpbmc7XG5pbXBvcnQgdXRpbCA9IERvcHBpby5WTS5VdGlsO1xuaW1wb3J0IFRocmVhZFN0YXR1cyA9IERvcHBpby5WTS5FbnVtcy5UaHJlYWRTdGF0dXM7XG5pbXBvcnQgZGVidWcgPSBsb2dnaW5nLmRlYnVnO1xuaW1wb3J0IGludGVyZmFjZXMgPSBEb3BwaW8uVk0uSW50ZXJmYWNlcztcbmltcG9ydCBKVk1UeXBlcyA9IHJlcXVpcmUoJy4uLy4uL2luY2x1ZGVzL0pWTVR5cGVzJyk7XG5kZWNsYXJlIHZhciByZWdpc3Rlck5hdGl2ZXM6IChkZWZzOiBhbnkpID0+IHZvaWQ7XG5cbmRlY2xhcmUgdmFyIFdlYnNvY2s6IHtcbiAgbmV3ICgpOiBpbnRlcmZhY2VzLklXZWJzb2NrO1xufVxuXG4vKipcbiAqIElmIGFuIGFwcGxpY2F0aW9uIHdhbnRzIHRvIG9wZW4gYSBUQ1AvVURQIGNvbm5lY3Rpb24gdG8gXCJmb29iYXIuY29tXCIsIHRoZSBhcHBsaWNhdGlvbiBtdXN0IGZpcnN0IHBlcmZvcm1cbiAqIGEgRE5TIGxvb2t1cCB0byBkZXRlcm1pbmUgdGhlIElQIG9mIHRoYXQgZG9tYWluLCBhbmQgdGhlbiBvcGVuIGEgc29ja2V0IHRvIHRoYXQgSVAuIERvcHBpbyBuZWVkcyB0byBlbXVsYXRlXG4gKiB0aGlzIHNhbWUgZnVuY3Rpb25hbGl0eSBpbiBKYXZhU2NyaXB0LlxuICpcbiAqIEhvd2V2ZXIsIHRoZSBicm93c2VyIGRvZXMgbm90IGV4cG9zZSBhbnkgRE5TIGludGVyZmFjZXMsIGFzIEROUyBsb29rdXAgaXMgcHJvdmlkZWQgb3BhcXVlbHkgYnkgdGhlIGJyb3dzZXJcbiAqIHBsYXRmb3JtLiBGb3IgZXhhbXBsZSwgYW4gYXBwbGljYXRpb24gY2FuIG1ha2UgYSBXZWJTb2NrZXQgY29ubmVjdGlvbiBkaXJlY3RseSB0byBcImh0dHBzOi8vZm9vYmFyLmNvbS9cIiwgYW5kXG4gKiB3aWxsIG5ldmVyIGtub3cgdGhhdCBkb21haW4ncyBJUC5cbiAqXG4gKiBUbyBnZXQgYXJvdW5kIHRoaXMgbWlzc2luZyBmdW5jdGlvbmFsaXR5LCBEb3BwaW8gcmV0dXJucyBhbiB1bnVzZWQgcHJpdmF0ZSBJUCBpbiB0aGUgcmFuZ2Ugb2YgMjQwLjAuMC4wIHRvXG4gKiAyNTAuMC4wLjAgZm9yIGVhY2ggdW5pcXVlIEROUyBsb29rdXAuIERvcHBpbyB1c2VzIHRoaXMgSVAgYXMgYSB0b2tlbiBmb3IgdGhhdCBwYXJ0aWN1bGFyIEROUyBsb29rdXAuIFdoZW5cbiAqIHRoZSBhcHBsaWNhdGlvbiBhdHRlbXB0cyB0byBjb25uZWN0IHRvIGFuIElQIGluIHRoaXMgcmFuZ2UsIERvcHBpbyB1c2VzIHRoZSBJUCBhcyBhIGtleSBpbnRvIGEgaGFzaCB0YWJsZSxcbiAqIHdoaWNoIHJldHVybnMgYSBkb21haW4gbmFtZSB0aGF0IERvcHBpbyB1c2VzIGluIHRoZSByZXN1bHRpbmcgV2ViU29ja2V0IGNvbm5lY3Rpb24uIEFuIGFwcGxpY2F0aW9uIHdpbGwgbmV2ZXJcbiAqIHRyeSB0byBjb25uZWN0IHRvIG9uZSBvZiB0aGVzZSBpbnZhbGlkIElQIGFkZHJlc3NlcyBkaXJlY3RseSwgc28gRG9wcGlvIGNhbiBkaXN0aW5ndWlzaCBiZXR3ZWVuIGNvbm5lY3Rpb25zIHRvXG4gKiBzcGVjaWZpYyBJUCBhZGRyZXNzZXMgYW5kIGNvbm5lY3Rpb25zIHRvIGRvbWFpbnMuXG4gKi9cbnZhciBob3N0X2xvb2t1cDoge1thZGRyOiBudW1iZXJdOiBzdHJpbmd9ID0ge30sXG4gIGhvc3RfcmV2ZXJzZV9sb29rdXA6IHtbcmVhbF9hZGRyOiBzdHJpbmddOiBudW1iZXJ9ID0ge30sXG4gIC8vIDI0MC4wLjAuMCAuLiAyNTAuMC4wLjAgaXMgY3VycmVudGx5IHVudXNlZCBhZGRyZXNzIHNwYWNlXG4gIG5leHRfaG9zdF9hZGRyZXNzID0gMHhGMDAwMDAwMDtcblxuLy8gU2VlIFJGQyA2NDU1IHNlY3Rpb24gNy40XG5mdW5jdGlvbiB3ZWJzb2NrZXRfc3RhdHVzX3RvX21lc3NhZ2Uoc3RhdHVzOiBudW1iZXIpOiBzdHJpbmcge1xuICBzd2l0Y2ggKHN0YXR1cykge1xuICAgIGNhc2UgMTAwMDpcbiAgICAgIHJldHVybiAnTm9ybWFsIGNsb3N1cmUnO1xuICAgIGNhc2UgMTAwMTpcbiAgICAgIHJldHVybiAnRW5kcG9pbnQgaXMgZ29pbmcgYXdheSc7XG4gICAgY2FzZSAxMDAyOlxuICAgICAgcmV0dXJuICdXZWJTb2NrZXQgcHJvdG9jb2wgZXJyb3InO1xuICAgIGNhc2UgMTAwMzpcbiAgICAgIHJldHVybiAnU2VydmVyIHJlY2VpdmVkIGludmFsaWQgZGF0YSc7XG4gIH1cbiAgcmV0dXJuICdVbmtub3duIHN0YXR1cyBjb2RlIG9yIGVycm9yJztcbn1cblxuZnVuY3Rpb24gbmV4dF9hZGRyZXNzKCk6IG51bWJlciB7XG4gIG5leHRfaG9zdF9hZGRyZXNzKys7XG4gIGlmIChuZXh0X2hvc3RfYWRkcmVzcyA+IDB4RkEwMDAwMDApIHtcbiAgICBsb2dnaW5nLmVycm9yKCdPdXQgb2YgYWRkcmVzc2VzJyk7XG4gICAgbmV4dF9ob3N0X2FkZHJlc3MgPSAweEYwMDAwMDAwO1xuICB9XG4gIHJldHVybiBuZXh0X2hvc3RfYWRkcmVzcztcbn1cblxuZnVuY3Rpb24gcGFja19hZGRyZXNzKGFkZHJlc3M6IG51bWJlcltdKTogbnVtYmVyIHtcbiAgdmFyIGk6IG51bWJlciwgcmV0ID0gMDtcbiAgZm9yIChpID0gMzsgaSA+PSAwOyBpLS0pIHtcbiAgICByZXQgfD0gYWRkcmVzc1tpXSAmIDB4RkY7XG4gICAgcmV0IDw8PSA4O1xuICB9XG4gIHJldHVybiByZXQ7XG59XG5cbmZ1bmN0aW9uIGhvc3RfYWxsb2NhdGVfYWRkcmVzcyhhZGRyZXNzOiBzdHJpbmcpOiBudW1iZXIge1xuICB2YXIgcmV0ID0gbmV4dF9hZGRyZXNzKCk7XG4gIGhvc3RfbG9va3VwW3JldF0gPSBhZGRyZXNzO1xuICBob3N0X3JldmVyc2VfbG9va3VwW2FkZHJlc3NdID0gcmV0O1xuICByZXR1cm4gcmV0O1xufVxuXG4vKipcbiAqIEFzeW5jaHJvbm91c2x5IHJlYWQgZGF0YSBmcm9tIGEgc29ja2V0LiBOb3RlIHRoYXQgaWYgdGhpcyBwYXNzZXMgMCB0byB0aGVcbiAqIGNhbGxiYWNrLCBKYXZhIHdpbGwgdGhpbmsgaXQgaGFzIHJlY2VpdmVkIGFuIEVPRi4gVGh1cywgd2Ugc2hvdWxkIHdhaXQgdW50aWw6XG4gKiAtIFdlIGhhdmUgYXQgbGVhc3Qgb25lIGJ5dGUgdG8gcmV0dXJuLlxuICogLSBUaGUgc29ja2V0IGlzIGNsb3NlZC5cbiAqL1xuZnVuY3Rpb24gc29ja2V0X3JlYWRfYXN5bmMoaW1wbDogSlZNVHlwZXMuamF2YV9uZXRfUGxhaW5Tb2NrZXRJbXBsLCBiOiBKVk1UeXBlcy5KVk1BcnJheTxudW1iZXI+LCBvZmZzZXQ6IG51bWJlciwgbGVuOiBudW1iZXIsIHJlc3VtZV9jYjogKGFyZzogbnVtYmVyKSA9PiB2b2lkKTogdm9pZCB7XG4gIHZhciBpOiBudW1iZXIsXG4gICAgYXZhaWxhYmxlID0gaW1wbC4kd3MuclFsZW4oKSxcbiAgICB0cmltbWVkX2xlbiA9IGF2YWlsYWJsZSA8IGxlbiA/IGF2YWlsYWJsZSA6IGxlbixcbiAgICByZWFkID0gaW1wbC4kd3MuclFzaGlmdEJ5dGVzKHRyaW1tZWRfbGVuKTtcbiAgZm9yIChpID0gMDsgaSA8IHRyaW1tZWRfbGVuOyBpKyspIHtcbiAgICBiLmFycmF5W29mZnNldCsrXSA9IHJlYWRbaV07XG4gIH1cbiAgcmVzdW1lX2NiKHRyaW1tZWRfbGVuKTtcbn1cblxuY2xhc3MgamF2YV9uZXRfSW5ldDRBZGRyZXNzIHtcblxuICBwdWJsaWMgc3RhdGljICdpbml0KClWJyh0aHJlYWQ6IEpWTVRocmVhZCk6IHZvaWQge1xuICAgIC8vIE5PUFxuICB9XG5cbn1cblxuY2xhc3MgamF2YV9uZXRfSW5ldDRBZGRyZXNzSW1wbCB7XG5cbiAgcHVibGljIHN0YXRpYyAnZ2V0TG9jYWxIb3N0TmFtZSgpTGphdmEvbGFuZy9TdHJpbmc7Jyh0aHJlYWQ6IEpWTVRocmVhZCwgamF2YVRoaXM6IEpWTVR5cGVzLmphdmFfbmV0X0luZXQ0QWRkcmVzc0ltcGwpOiBKVk1UeXBlcy5qYXZhX2xhbmdfU3RyaW5nIHtcbiAgICByZXR1cm4gdGhyZWFkLmdldEpWTSgpLmludGVyblN0cmluZygnbG9jYWxob3N0Jyk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljICdsb29rdXBBbGxIb3N0QWRkcihMamF2YS9sYW5nL1N0cmluZzspW0xqYXZhL25ldC9JbmV0QWRkcmVzczsnKHRocmVhZDogSlZNVGhyZWFkLCBqYXZhVGhpczogSlZNVHlwZXMuamF2YV9uZXRfSW5ldDRBZGRyZXNzSW1wbCwgaG9zdG5hbWU6IEpWTVR5cGVzLmphdmFfbGFuZ19TdHJpbmcpOiB2b2lkIHtcbiAgICB2YXIgcnYgPSB1dGlsLm5ld09iamVjdDxKVk1UeXBlcy5qYXZhX25ldF9JbmV0NEFkZHJlc3M+KHRocmVhZCwgdGhyZWFkLmdldEJzQ2woKSwgJ0xqYXZhL25ldC9JbmV0NEFkZHJlc3M7Jyk7XG4gICAgcnZbJzxpbml0PihMamF2YS9sYW5nL1N0cmluZztJKVYnXSh0aHJlYWQsIFtob3N0bmFtZSwgaG9zdF9hbGxvY2F0ZV9hZGRyZXNzKGhvc3RuYW1lLnRvU3RyaW5nKCkpXSwgKGU/OiBKVk1UeXBlcy5qYXZhX2xhbmdfVGhyb3dhYmxlKSA9PiB7XG4gICAgICBpZiAoZSkge1xuICAgICAgICB0aHJlYWQudGhyb3dFeGNlcHRpb24oZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJlYWQuYXN5bmNSZXR1cm4odXRpbC5uZXdBcnJheUZyb21EYXRhPEpWTVR5cGVzLmphdmFfbmV0X0luZXRBZGRyZXNzPih0aHJlYWQsIHRocmVhZC5nZXRCc0NsKCksICdbTGphdmEvbmV0L0luZXRBZGRyZXNzOycsIFtydl0pKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgJ2dldEhvc3RCeUFkZHIoW0IpTGphdmEvbGFuZy9TdHJpbmc7Jyh0aHJlYWQ6IEpWTVRocmVhZCwgamF2YVRoaXM6IEpWTVR5cGVzLmphdmFfbmV0X0luZXQ0QWRkcmVzc0ltcGwsIGFkZHI6IEpWTVR5cGVzLkpWTUFycmF5PG51bWJlcj4pOiBKVk1UeXBlcy5qYXZhX2xhbmdfU3RyaW5nIHtcbiAgICB2YXIgcmV0ID0gaG9zdF9yZXZlcnNlX2xvb2t1cFtwYWNrX2FkZHJlc3MoYWRkci5hcnJheSldO1xuICAgIGlmIChyZXQgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiB1dGlsLmluaXRTdHJpbmcodGhyZWFkLmdldEJzQ2woKSwgXCJcIiArIHJldCk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljICdpc1JlYWNoYWJsZTAoW0JJW0JJKVonKHRocmVhZDogSlZNVGhyZWFkLCBqYXZhVGhpczogSlZNVHlwZXMuamF2YV9uZXRfSW5ldDRBZGRyZXNzSW1wbCwgYXJnMDogSlZNVHlwZXMuSlZNQXJyYXk8bnVtYmVyPiwgYXJnMTogbnVtYmVyLCBhcmcyOiBKVk1UeXBlcy5KVk1BcnJheTxudW1iZXI+LCBhcmczOiBudW1iZXIpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxufVxuXG5jbGFzcyBqYXZhX25ldF9JbmV0NkFkZHJlc3Mge1xuXG4gIHB1YmxpYyBzdGF0aWMgJ2luaXQoKVYnKHRocmVhZDogSlZNVGhyZWFkKTogdm9pZCB7XG4gICAgLy8gTk9QXG4gIH1cblxufVxuXG5jbGFzcyBqYXZhX25ldF9JbmV0QWRkcmVzcyB7XG5cbiAgcHVibGljIHN0YXRpYyAnaW5pdCgpVicodGhyZWFkOiBKVk1UaHJlYWQpOiB2b2lkIHtcbiAgICAvLyBOT1BcbiAgfVxuXG59XG5cbmNsYXNzIGphdmFfbmV0X0luZXRBZGRyZXNzSW1wbEZhY3Rvcnkge1xuXG4gIHB1YmxpYyBzdGF0aWMgJ2lzSVB2NlN1cHBvcnRlZCgpWicodGhyZWFkOiBKVk1UaHJlYWQpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxufVxuXG5jbGFzcyBqYXZhX25ldF9QbGFpblNvY2tldEltcGwge1xuXG4gIHB1YmxpYyBzdGF0aWMgJ3NvY2tldENyZWF0ZShaKVYnKHRocmVhZDogSlZNVGhyZWFkLCBqYXZhVGhpczogSlZNVHlwZXMuamF2YV9uZXRfUGxhaW5Tb2NrZXRJbXBsLCBpc1NlcnZlcjogbnVtYmVyKTogdm9pZCB7XG4gICAgLy8gQ2hlY2sgdG8gbWFrZSBzdXJlIHdlJ3JlIGluIGEgYnJvd3NlciBhbmQgdGhlIHdlYnNvY2tldCBsaWJyYXJpZXMgYXJlIHByZXNlbnRcbiAgICBpZiAoIXV0aWwuYXJlX2luX2Jyb3dzZXIoKSkge1xuICAgICAgdGhyZWFkLnRocm93TmV3RXhjZXB0aW9uKCdMamF2YS9pby9JT0V4Y2VwdGlvbjsnLCAnV2ViU29ja2V0cyBhcmUgZGlzYWJsZWQnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGZkID0gamF2YVRoaXNbJ2phdmEvbmV0L1NvY2tldEltcGwvZmQnXTtcbiAgICAgIC8vIE1ha2UgdGhlIEZpbGVEZXNjcmlwdG9yIHZhbGlkIHdpdGggYSBkdW1teSBmZFxuICAgICAgZmRbJ2phdmEvaW8vRmlsZURlc2NyaXB0b3IvZmQnXSA9IDgzNzQ7XG4gICAgICAvLyBGaW5hbGx5LCBjcmVhdGUgb3VyIHdlYnNvY2tldCBpbnN0YW5jZVxuICAgICAgamF2YVRoaXMuJHdzID0gbmV3IFdlYnNvY2soKTtcbiAgICAgIGphdmFUaGlzLiRpc19zaHV0ZG93biA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgJ3NvY2tldENvbm5lY3QoTGphdmEvbmV0L0luZXRBZGRyZXNzO0lJKVYnKHRocmVhZDogSlZNVGhyZWFkLCBqYXZhVGhpczogSlZNVHlwZXMuamF2YV9uZXRfUGxhaW5Tb2NrZXRJbXBsLCBhZGRyZXNzOiBKVk1UeXBlcy5qYXZhX25ldF9JbmV0QWRkcmVzcywgcG9ydDogbnVtYmVyLCB0aW1lb3V0OiBudW1iZXIpOiB2b2lkIHtcbiAgICB2YXIgaTogbnVtYmVyLFxuICAgICAgLy8gVGhlIElQdjQgY2FzZVxuICAgICAgaG9sZGVyID0gYWRkcmVzc1snamF2YS9uZXQvSW5ldEFkZHJlc3MvaG9sZGVyJ10sXG4gICAgICBhZGR5ID0gaG9sZGVyWydqYXZhL25ldC9JbmV0QWRkcmVzcyRJbmV0QWRkcmVzc0hvbGRlci9hZGRyZXNzJ10sXG4gICAgICAvLyBBc3N1bWUgc2NoZW1lIGlzIHdzIGZvciBub3dcbiAgICAgIGhvc3QgPSAnd3M6Ly8nO1xuICAgIGlmIChob3N0X2xvb2t1cFthZGR5XSA9PSBudWxsKSB7XG4gICAgICAvLyBQb3B1bGF0ZSBob3N0IHN0cmluZyBiYXNlZCBvZmYgb2YgSVAgYWRkcmVzc1xuICAgICAgZm9yIChpID0gMzsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgdmFyIHNoaWZ0ID0gaSAqIDg7XG4gICAgICAgIGhvc3QgKz0gXCJcIiArICgoYWRkeSAmICgweEZGIDw8IHNoaWZ0KSkgPj4+IHNoaWZ0KSArIFwiLlwiO1xuICAgICAgfVxuICAgICAgLy8gdHJpbSBsYXN0ICcuJ1xuICAgICAgaG9zdCA9IGhvc3Quc3Vic3RyaW5nKDAsIGhvc3QubGVuZ3RoIC0gMSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGhvc3QgKz0gaG9zdF9sb29rdXBbYWRkeV07XG4gICAgfVxuICAgIC8vIEFkZCBwb3J0XG4gICAgaG9zdCArPSBcIjpcIiArIHBvcnQ7XG4gICAgZGVidWcoXCJDb25uZWN0aW5nIHRvIFwiICsgaG9zdCArIFwiIHdpdGggdGltZW91dCA9IFwiICsgdGltZW91dCArIFwiIG1zXCIpO1xuICAgIHRocmVhZC5zZXRTdGF0dXMoVGhyZWFkU3RhdHVzLkFTWU5DX1dBSVRJTkcpO1xuICAgIHZhciBpZCA9IDAsXG4gICAgICBjbGVhcl9zdGF0ZSA9ICgpID0+IHtcbiAgICAgICAgd2luZG93LmNsZWFyVGltZW91dChpZCk7XG4gICAgICAgIGphdmFUaGlzLiR3cy5vbignb3BlbicsICgpID0+IHsgfSk7XG4gICAgICAgIGphdmFUaGlzLiR3cy5vbignY2xvc2UnLCAoKSA9PiB7IH0pO1xuICAgICAgICBqYXZhVGhpcy4kd3Mub24oJ2Vycm9yJywgKCkgPT4geyB9KTtcbiAgICAgIH0sXG4gICAgICBlcnJvcl9jYiA9IChtc2c6IHN0cmluZykgPT4ge1xuICAgICAgICByZXR1cm4gKGU6IGFueSkgPT4ge1xuICAgICAgICAgIGNsZWFyX3N0YXRlKCk7XG4gICAgICAgICAgdGhyZWFkLnRocm93TmV3RXhjZXB0aW9uKCdMamF2YS9pby9JT0V4Y2VwdGlvbjsnLCBtc2cgKyBcIjogXCIgKyBlKTtcbiAgICAgICAgfTtcbiAgICAgIH0sXG4gICAgICBjbG9zZV9jYiA9IChtc2c6IHN0cmluZykgPT4ge1xuICAgICAgICByZXR1cm4gKGU6IGFueSkgPT4ge1xuICAgICAgICAgIGNsZWFyX3N0YXRlKCk7XG4gICAgICAgICAgdGhyZWFkLnRocm93TmV3RXhjZXB0aW9uKCdMamF2YS9pby9JT0V4Y2VwdGlvbjsnLCBtc2cgKyBcIjogXCIgKyB3ZWJzb2NrZXRfc3RhdHVzX3RvX21lc3NhZ2UoZS5zdGF0dXMpKTtcbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgLy8gU3VjY2VzcyBjYXNlXG4gICAgamF2YVRoaXMuJHdzLm9uKCdvcGVuJywgKCkgPT4ge1xuICAgICAgZGVidWcoJ09wZW4hJyk7XG4gICAgICBjbGVhcl9zdGF0ZSgpO1xuICAgICAgdGhyZWFkLmFzeW5jUmV0dXJuKCk7XG4gICAgfSk7XG4gICAgLy8gRXJyb3IgY2FzZXNcbiAgICBqYXZhVGhpcy4kd3Mub24oJ2Nsb3NlJywgY2xvc2VfY2IoJ0Nvbm5lY3Rpb24gZmFpbGVkISAoQ2xvc2VkKScpKTtcbiAgICAvLyBUaW1lb3V0IGNhc2UuIEluIHRoZSBjYXNlIG9mIG5vIHRpbWVvdXQsIHdlIHNldCBhIGRlZmF1bHQgb25lIG9mIDEwcy5cbiAgICBpZiAodGltZW91dCA9PT0gMCkge1xuICAgICAgdGltZW91dCA9IDEwMDAwO1xuICAgIH1cbiAgICAvLyBYWFg6IENhc3RpbmcgdG8gYSBudW1iZXIgYmVjYXVzZSBOb2RlSlMgdHlwaW5ncyBzcGVjaWZ5IGEgVGltZXIgb2JqZWN0LlxuICAgIGlkID0gPG51bWJlcj48YW55PiBzZXRUaW1lb3V0KGVycm9yX2NiKCdDb25uZWN0aW9uIHRpbWVvdXQhJyksIHRpbWVvdXQpO1xuICAgIGRlYnVnKFwiSG9zdDogXCIgKyBob3N0KTtcbiAgICAvLyBMYXVuY2ghXG4gICAgdHJ5IHtcbiAgICAgIGphdmFUaGlzLiR3cy5vcGVuKGhvc3QpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgZXJyb3JfY2IoJ0Nvbm5lY3Rpb24gZmFpbGVkISAoZXhjZXB0aW9uKScpKGVyci5tZXNzYWdlKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc3RhdGljICdzb2NrZXRCaW5kKExqYXZhL25ldC9JbmV0QWRkcmVzcztJKVYnKHRocmVhZDogSlZNVGhyZWFkLCBqYXZhVGhpczogSlZNVHlwZXMuamF2YV9uZXRfUGxhaW5Tb2NrZXRJbXBsLCBhcmcwOiBKVk1UeXBlcy5qYXZhX25ldF9JbmV0QWRkcmVzcywgYXJnMTogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhyZWFkLnRocm93TmV3RXhjZXB0aW9uKCdMamF2YS9pby9JT0V4Y2VwdGlvbjsnLCAnV2ViU29ja2V0cyBkb2VzblxcJ3Qga25vdyBob3cgdG8gYmluZCcpO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyAnc29ja2V0TGlzdGVuKEkpVicodGhyZWFkOiBKVk1UaHJlYWQsIGphdmFUaGlzOiBKVk1UeXBlcy5qYXZhX25ldF9QbGFpblNvY2tldEltcGwsIGFyZzA6IG51bWJlcik6IHZvaWQge1xuICAgIHRocmVhZC50aHJvd05ld0V4Y2VwdGlvbignTGphdmEvaW8vSU9FeGNlcHRpb247JywgJ1dlYlNvY2tldHMgZG9lc25cXCd0IGtub3cgaG93IHRvIGxpc3RlbicpO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyAnc29ja2V0QWNjZXB0KExqYXZhL25ldC9Tb2NrZXRJbXBsOylWJyh0aHJlYWQ6IEpWTVRocmVhZCwgamF2YVRoaXM6IEpWTVR5cGVzLmphdmFfbmV0X1BsYWluU29ja2V0SW1wbCwgYXJnMDogSlZNVHlwZXMuamF2YV9uZXRfU29ja2V0SW1wbCk6IHZvaWQge1xuICAgIHRocmVhZC50aHJvd05ld0V4Y2VwdGlvbignTGphdmEvaW8vSU9FeGNlcHRpb247JywgJ1dlYlNvY2tldHMgZG9lc25cXCd0IGtub3cgaG93IHRvIGFjY2VwdCcpO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyAnc29ja2V0QXZhaWxhYmxlKClJJyh0aHJlYWQ6IEpWTVRocmVhZCwgamF2YVRoaXM6IEpWTVR5cGVzLmphdmFfbmV0X1BsYWluU29ja2V0SW1wbCk6IHZvaWQge1xuICAgIHRocmVhZC5zZXRTdGF0dXMoVGhyZWFkU3RhdHVzLkFTWU5DX1dBSVRJTkcpO1xuICAgIHNldEltbWVkaWF0ZSgoKSA9PiB7XG4gICAgICB0aHJlYWQuYXN5bmNSZXR1cm4oamF2YVRoaXMuJHdzLnJRbGVuKCkpO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyAnc29ja2V0Q2xvc2UwKFopVicodGhyZWFkOiBKVk1UaHJlYWQsIGphdmFUaGlzOiBKVk1UeXBlcy5qYXZhX25ldF9QbGFpblNvY2tldEltcGwsIGFyZzA6IG51bWJlcik6IHZvaWQge1xuICAgIC8vIFRPRE86IFNvbWV0aGluZyBpc24ndCB3b3JraW5nIGhlcmVcbiAgICBqYXZhVGhpcy4kd3MuY2xvc2UoKTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgJ3NvY2tldFNodXRkb3duKEkpVicodGhyZWFkOiBKVk1UaHJlYWQsIGphdmFUaGlzOiBKVk1UeXBlcy5qYXZhX25ldF9QbGFpblNvY2tldEltcGwsIGFyZzA6IG51bWJlcik6IHZvaWQge1xuICAgIGphdmFUaGlzLiRpc19zaHV0ZG93biA9IHRydWU7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljICdpbml0UHJvdG8oKVYnKHRocmVhZDogSlZNVGhyZWFkKTogdm9pZCB7XG4gICAgLy8gTk9QXG4gIH1cblxuICBwdWJsaWMgc3RhdGljICdzb2NrZXRTZXRPcHRpb24wKElaTGphdmEvbGFuZy9PYmplY3Q7KVYnKHRocmVhZDogSlZNVGhyZWFkLCBqYXZhVGhpczogSlZNVHlwZXMuamF2YV9uZXRfUGxhaW5Tb2NrZXRJbXBsLCBhcmcwOiBudW1iZXIsIGFyZzE6IG51bWJlciwgYXJnMjogSlZNVHlwZXMuamF2YV9sYW5nX09iamVjdCk6IHZvaWQge1xuICAgIC8vIE5PUFxuICB9XG5cbiAgcHVibGljIHN0YXRpYyAnc29ja2V0R2V0T3B0aW9uKElMamF2YS9sYW5nL09iamVjdDspSScodGhyZWFkOiBKVk1UaHJlYWQsIGphdmFUaGlzOiBKVk1UeXBlcy5qYXZhX25ldF9QbGFpblNvY2tldEltcGwsIGFyZzA6IG51bWJlciwgYXJnMTogSlZNVHlwZXMuamF2YV9sYW5nX09iamVjdCk6IG51bWJlciB7XG4gICAgLy8gTk9QXG4gICAgcmV0dXJuIDA7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljICdzb2NrZXRTZW5kVXJnZW50RGF0YShJKVYnKHRocmVhZDogSlZNVGhyZWFkLCBqYXZhVGhpczogSlZNVHlwZXMuamF2YV9uZXRfUGxhaW5Tb2NrZXRJbXBsLCBkYXRhOiBudW1iZXIpOiB2b2lkIHtcbiAgICAvLyBVcmdlbnQgZGF0YSBpcyBtZWFudCB0byBqdW1wIGFoZWFkIG9mIHRoZVxuICAgIC8vIG91dGJvdW5kIHN0cmVhbS4gV2Uga2VlcCBubyBub3Rpb24gb2YgdGhpcyxcbiAgICAvLyBzbyBxdWV1ZSB1cCB0aGUgYnl0ZSBsaWtlIG5vcm1hbFxuICAgIGphdmFUaGlzLiR3cy5zZW5kKGRhdGEpO1xuICB9XG5cbn1cblxuY2xhc3MgamF2YV9uZXRfU29ja2V0SW5wdXRTdHJlYW0ge1xuXG4gIHB1YmxpYyBzdGF0aWMgJ3NvY2tldFJlYWQwKExqYXZhL2lvL0ZpbGVEZXNjcmlwdG9yO1tCSUlJKUknKHRocmVhZDogSlZNVGhyZWFkLCBqYXZhVGhpczogSlZNVHlwZXMuamF2YV9uZXRfU29ja2V0SW5wdXRTdHJlYW0sIGZkOiBKVk1UeXBlcy5qYXZhX2lvX0ZpbGVEZXNjcmlwdG9yLCBiOiBKVk1UeXBlcy5KVk1BcnJheTxudW1iZXI+LCBvZmZzZXQ6IG51bWJlciwgbGVuOiBudW1iZXIsIHRpbWVvdXQ6IG51bWJlcik6IHZvaWQge1xuICAgIHZhciBpbXBsID0gPEpWTVR5cGVzLmphdmFfbmV0X1BsYWluU29ja2V0SW1wbD4gamF2YVRoaXNbJ2phdmEvbmV0L1NvY2tldElucHV0U3RyZWFtL2ltcGwnXTtcbiAgICBpZiAoaW1wbC4kaXNfc2h1dGRvd24gPT09IHRydWUpIHtcbiAgICAgIHRocmVhZC50aHJvd05ld0V4Y2VwdGlvbignTGphdmEvaW8vSU9FeGNlcHRpb247JywgJ1NvY2tldCBpcyBzaHV0ZG93bi4nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyZWFkLnNldFN0YXR1cyhUaHJlYWRTdGF0dXMuQVNZTkNfV0FJVElORyk7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgc29ja2V0X3JlYWRfYXN5bmMoaW1wbCwgYiwgb2Zmc2V0LCBsZW4sIChhcmc6IG51bWJlcikgPT4ge1xuICAgICAgICAgIHRocmVhZC5hc3luY1JldHVybihhcmcpO1xuICAgICAgICB9KVxuICAgICAgfSwgdGltZW91dCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHN0YXRpYyAnaW5pdCgpVicodGhyZWFkOiBKVk1UaHJlYWQpOiB2b2lkIHtcbiAgICAvLyBOT1BcbiAgfVxuXG59XG5cbmNsYXNzIGphdmFfbmV0X1NvY2tldE91dHB1dFN0cmVhbSB7XG5cbiAgcHVibGljIHN0YXRpYyAnc29ja2V0V3JpdGUwKExqYXZhL2lvL0ZpbGVEZXNjcmlwdG9yO1tCSUkpVicodGhyZWFkOiBKVk1UaHJlYWQsIGphdmFUaGlzOiBKVk1UeXBlcy5qYXZhX25ldF9Tb2NrZXRPdXRwdXRTdHJlYW0sIGZkOiBKVk1UeXBlcy5qYXZhX2lvX0ZpbGVEZXNjcmlwdG9yLCBiOiBKVk1UeXBlcy5KVk1BcnJheTxudW1iZXI+LCBvZmZzZXQ6IG51bWJlciwgbGVuOiBudW1iZXIpOiB2b2lkIHtcbiAgICB2YXIgaW1wbCA9IDxKVk1UeXBlcy5qYXZhX25ldF9QbGFpblNvY2tldEltcGw+IGphdmFUaGlzWydqYXZhL25ldC9Tb2NrZXRPdXRwdXRTdHJlYW0vaW1wbCddO1xuICAgIGlmIChpbXBsLiRpc19zaHV0ZG93biA9PT0gdHJ1ZSkge1xuICAgICAgdGhyZWFkLnRocm93TmV3RXhjZXB0aW9uKCdMamF2YS9pby9JT0V4Y2VwdGlvbjsnLCAnU29ja2V0IGlzIHNodXRkb3duLicpO1xuICAgIH0gZWxzZSBpZiAoaW1wbC4kd3MuZ2V0X3Jhd19zdGF0ZSgpICE9PSBXZWJTb2NrZXQuT1BFTikge1xuICAgICAgdGhyZWFkLnRocm93TmV3RXhjZXB0aW9uKCdMamF2YS9pby9JT0V4Y2VwdGlvbjsnLCAnQ29ubmVjdGlvbiBpc25cXCd0IG9wZW4nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVE9ETzogVGhpcyBjYW4gYmUgb3B0aW1pemVkIGJ5IGFjY2Vzc2luZyB0aGUgJ1EnIGRpcmVjdGx5XG4gICAgICBpbXBsLiR3cy5zZW5kKGIuYXJyYXkuc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyBsZW4pKTtcbiAgICAgIC8vIExldCB0aGUgYnJvd3NlciB3cml0ZSBpdCBvdXRcbiAgICAgIHRocmVhZC5zZXRTdGF0dXMoVGhyZWFkU3RhdHVzLkFTWU5DX1dBSVRJTkcpO1xuICAgICAgc2V0SW1tZWRpYXRlKCgpID0+IHtcbiAgICAgICAgdGhyZWFkLmFzeW5jUmV0dXJuKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc3RhdGljICdpbml0KClWJyh0aHJlYWQ6IEpWTVRocmVhZCk6IHZvaWQge1xuICAgIC8vIE5PUFxuICB9XG5cbn1cblxuY2xhc3MgamF2YV9uZXRfTmV0d29ya0ludGVyZmFjZSB7XG4gIHB1YmxpYyBzdGF0aWMgJ2luaXQoKVYnKHRocmVhZDogSlZNVGhyZWFkKTogdm9pZCB7XG4gICAgLy8gTk9QXG4gIH1cblxuICBwdWJsaWMgc3RhdGljICdnZXRBbGwoKVtMamF2YS9uZXQvTmV0d29ya0ludGVyZmFjZTsnKHRocmVhZDogSlZNVGhyZWFkKTogdm9pZCB7XG4gICAgbGV0IGJzQ2wgPSB0aHJlYWQuZ2V0QnNDbCgpO1xuICAgIC8vIENyZWF0ZSBhIGZha2UgbmV0d29yayBpbnRlcmZhY2UgYm91bmQgdG8gMTI3LjEuMS4xLlxuICAgIHRocmVhZC5pbXBvcnQoWydMamF2YS9uZXQvTmV0d29ya0ludGVyZmFjZTsnLCAnTGphdmEvbmV0L0luZXRBZGRyZXNzOyddLCAocnY6IFtJSlZNQ29uc3RydWN0b3I8SlZNVHlwZXMuamF2YV9uZXRfTmV0d29ya0ludGVyZmFjZT4sIHR5cGVvZiBKVk1UeXBlcy5qYXZhX25ldF9JbmV0QWRkcmVzc10pID0+IHtcbiAgICAgIGxldCBuaUNvbnMgPSBydlswXSwgaW5ldFN0YXRpY3MgPSBydlsxXSxcbiAgICAgICAgaU5hbWUgPSB0aHJlYWQuZ2V0SlZNKCkuaW50ZXJuU3RyaW5nKCdkb3BwaW8xJyk7XG4gICAgICBpbmV0U3RhdGljc1snZ2V0QnlBZGRyZXNzKExqYXZhL2xhbmcvU3RyaW5nO1tCKUxqYXZhL25ldC9JbmV0QWRkcmVzczsnXSh0aHJlYWQsXG4gICAgICAgIFtpTmFtZSwgdXRpbC5uZXdBcnJheUZyb21EYXRhPG51bWJlcj4odGhyZWFkLCB0aHJlYWQuZ2V0QnNDbCgpLCAnW0InLCBbMTI3LDEsMSwxXSldLCAoZT86IEpWTVR5cGVzLmphdmFfbGFuZ19UaHJvd2FibGUsIHJ2PzogSlZNVHlwZXMuamF2YV9uZXRfSW5ldEFkZHJlc3MpID0+IHtcbiAgICAgICAgaWYgKGUpIHtcbiAgICAgICAgICB0aHJlYWQudGhyb3dFeGNlcHRpb24oZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIG5pT2JqID0gbmV3IG5pQ29ucyh0aHJlYWQpO1xuICAgICAgICAgIG5pT2JqWyc8aW5pdD4oTGphdmEvbGFuZy9TdHJpbmc7SVtMamF2YS9uZXQvSW5ldEFkZHJlc3M7KVYnXSh0aHJlYWQsIFtpTmFtZSwgMCwgdXRpbC5uZXdBcnJheUZyb21EYXRhPEpWTVR5cGVzLmphdmFfbmV0X0luZXRBZGRyZXNzPih0aHJlYWQsIGJzQ2wsICdbTGphdmEvbmV0L0luZXRBZGRyZXNzOycsIFtydl0pXSwgKGU/OiBKVk1UeXBlcy5qYXZhX2xhbmdfVGhyb3dhYmxlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZSkge1xuICAgICAgICAgICAgICB0aHJlYWQudGhyb3dFeGNlcHRpb24oZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aHJlYWQuYXN5bmNSZXR1cm4odXRpbC5uZXdBcnJheUZyb21EYXRhPEpWTVR5cGVzLmphdmFfbmV0X05ldHdvcmtJbnRlcmZhY2U+KHRocmVhZCwgYnNDbCwgJ1tMamF2YS9uZXQvTmV0d29ya0ludGVyZmFjZTsnLCBbbmlPYmpdKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyAnZ2V0TWFjQWRkcjAoW0JMamF2YS9sYW5nL1N0cmluZztJKVtCJyh0aHJlYWQ6IEpWTVRocmVhZCwgaW5BZGRyOiBKVk1UeXBlcy5KVk1BcnJheTxudW1iZXI+LCBuYW1lOiBKVk1UeXBlcy5KVk1BcnJheTxudW1iZXI+LCBpbmQ6IG51bWJlcik6IEpWTVR5cGVzLkpWTUFycmF5PG51bWJlcj4ge1xuICAgIHJldHVybiB1dGlsLm5ld0FycmF5RnJvbURhdGE8bnVtYmVyPih0aHJlYWQsIHRocmVhZC5nZXRCc0NsKCksICdbQicsIFsxLDEsMSwxLDEsMV0pO1xuICB9XG59XG5cbnJlZ2lzdGVyTmF0aXZlcyh7XG4gICdqYXZhL25ldC9JbmV0NEFkZHJlc3MnOiBqYXZhX25ldF9JbmV0NEFkZHJlc3MsXG4gICdqYXZhL25ldC9JbmV0NEFkZHJlc3NJbXBsJzogamF2YV9uZXRfSW5ldDRBZGRyZXNzSW1wbCxcbiAgJ2phdmEvbmV0L0luZXQ2QWRkcmVzcyc6IGphdmFfbmV0X0luZXQ2QWRkcmVzcyxcbiAgJ2phdmEvbmV0L0luZXRBZGRyZXNzJzogamF2YV9uZXRfSW5ldEFkZHJlc3MsXG4gICdqYXZhL25ldC9JbmV0QWRkcmVzc0ltcGxGYWN0b3J5JzogamF2YV9uZXRfSW5ldEFkZHJlc3NJbXBsRmFjdG9yeSxcbiAgJ2phdmEvbmV0L1BsYWluU29ja2V0SW1wbCc6IGphdmFfbmV0X1BsYWluU29ja2V0SW1wbCxcbiAgJ2phdmEvbmV0L1NvY2tldElucHV0U3RyZWFtJzogamF2YV9uZXRfU29ja2V0SW5wdXRTdHJlYW0sXG4gICdqYXZhL25ldC9Tb2NrZXRPdXRwdXRTdHJlYW0nOiBqYXZhX25ldF9Tb2NrZXRPdXRwdXRTdHJlYW0sXG4gICdqYXZhL25ldC9OZXR3b3JrSW50ZXJmYWNlJzogamF2YV9uZXRfTmV0d29ya0ludGVyZmFjZVxufSk7XG4iXX0=