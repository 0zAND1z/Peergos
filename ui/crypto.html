<!doctype html>
<html>
<head>
</head>
    
<body>
<h1>RSA examples</h1>
<script type="text/javascript" src="lib/kbpgp-2.0.8.js"></script>
<script type="text/javascript" src="lib/api.js"></script>
<script>
function encryptResult(err, result_string, result_buffer) {
    console.log(err, result_string, result_buffer);
    
}

function genresult(err, user) {
    if (err)
        console.log(err)
    else {
        console.log(user);
        //var input = new kbpgp.Buffer("G'day mate!");
        user.encryptMessageFor("G'day mate!", encryptResult)
    }
}
function generate() {
    console.log("generating..");
    var bits = parseInt(document.getElementById("bits").value);
    var username = document.getElementById("username").value;
    var password = document.getElementById("password").value;
    
    generateKeyPair("fred", "pass", genresult);

    /*kbpgp.KeyManager.generate_rsa({"userid":"someone"}, 
        function(err, keys){
            keys.sign({}, function(err) {});
            keys.export_pgp_public({}, function(err, publ) {
                console.log("public key: "+ publ);});
            keys.export_pgp_private({passphrase: 'booyeah!'}, function(err, priv) {
                console.log("private key: " +priv);});

            var params = {
                msg:         "G'day mate!",
                encrypt_for: keys
            };

            kbpgp.box(params, function(err, result_string, result_buffer) {
                console.log(err, result_string, result_buffer);
                kbpgp.unbox({"keyfetch": keys, "raw": result_buffer}, function(err, literals) {
                    if (err != null) {
                        return console.log("Problem: " + err);
                    } else {
                        console.log("decrypted message");
                        console.log(literals[0].toString());
                        var ds = km = null;
                        ds = literals[0].get_data_signer();
                        if (ds) { km = ds.get_key_manager(); }
                        if (km) {
                            console.log("Signed by PGP fingerprint");
                            console.log(km.get_pgp_fingerprint().toString('hex'));
                        }
                    }
                });
            });
        }
    );*/

    //var /*Uint8Array*/ pbkdf_bytes = scrypt.crypto_scrypt(scrypt.encode_utf8(password),
    //					      scrypt.encode_utf8(username),
    //					      n, r, p, desiredBytes);
    //var keypair = cryptico.generateRSAKey(scrypt.to_hex(pbkdf_bytes), bits);
    //pub = getPublicBaseKeyB64(keypair);
    //priv = getPrivateBaseKeyB64(keypair);
    //var pubString = "-----BEGIN PUBLIC KEY-----\n" + wordwrap(getPublicBaseKeyB64(keypair)) + "\n-----END PUBLIC KEY-----";
    //var privString = "-----BEGIN RSA PRIVATE KEY-----\n" + wordwrap(getPrivateBaseKeyB64(keypair)) + "\n-----END RSA PRIVATE KEY-----";

      //document.getElementById("status").innerHTML = ('Generated in ' + time + ' ms');
      //document.getElementById("private").value = privString;//crypt.getPrivateKey();
      //document.getElementById("public").value = pubString;//crypt.getPublicKey();
}
function encrypt() {
    console.log("encrypting..");
    document.getElementById("encrypted").value = encryptStringToHex(document.getElementById("data").value, 
        document.getElementById("public").value);
}
function decrypt() {
    console.log("decrypting..");
    document.getElementById("decrypted").value = decryptHexToString(document.getElementById("encrypted").value, 
        document.getElementById("private").value);
}
</script>

<label>Username:</label>
<textarea id="username" size="20">user</textarea><br/>
<label>Password:</label>
<textarea id="password" size="20">pass</textarea><br/>
<select id="bits">
  <option value="1024">1024</option>
  <option value="2048">2048</option>
  <option value="4096">4096</option>
</select>
<br/>
<button id="genButton" onclick="generate();">Generate keys</button>

<p/>
<textarea id="public" placeholder="Public Key" cols="65" rows="10">-----BEGIN PUBLIC KEY-----
MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDlOJu6TyygqxfWT7eLtGDwajtN
FOb9I5XRb6khyfD1Yt3YiCgQWMNW649887VGJiGr/L5i2osbl8C9+WJTeucF+S76
xFxdU6jE0NQ+Z+zEdhUTooNRaY5nZiu5PgDB0ED/ZKBUSLKL7eibMxZtMlUDHjm4
gwQco1KRMDSmXSMkDwIDAQAB
-----END PUBLIC KEY-----</textarea><br/>
<textarea id="private" placeholder="Private Key" cols="65" rows="15">-----BEGIN RSA PRIVATE KEY-----
MIICXQIBAAKBgQDlOJu6TyygqxfWT7eLtGDwajtNFOb9I5XRb6khyfD1Yt3YiCgQ
WMNW649887VGJiGr/L5i2osbl8C9+WJTeucF+S76xFxdU6jE0NQ+Z+zEdhUTooNR
aY5nZiu5PgDB0ED/ZKBUSLKL7eibMxZtMlUDHjm4gwQco1KRMDSmXSMkDwIDAQAB
AoGAfY9LpnuWK5Bs50UVep5c93SJdUi82u7yMx4iHFMc/Z2hfenfYEzu+57fI4fv
xTQ//5DbzRR/XKb8ulNv6+CHyPF31xk7YOBfkGI8qjLoq06V+FyBfDSwL8KbLyeH
m7KUZnLNQbk8yGLzB3iYKkRHlmUanQGaNMIJziWOkN+N9dECQQD0ONYRNZeuM8zd
8XJTSdcIX4a3gy3GGCJxOzv16XHxD03GW6UNLmfPwenKu+cdrQeaqEixrCejXdAF
z/7+BSMpAkEA8EaSOeP5Xr3ZrbiKzi6TGMwHMvC7HdJxaBJbVRfApFrE0/mPwmP5
rN7QwjrMY+0+AbXcm8mRQyQ1+IGEembsdwJBAN6az8Rv7QnD/YBvi52POIlRSSIM
V7SwWvSK4WSMnGb1ZBbhgdg57DXaspcwHsFV7hByQ5BvMtIduHcT14ECfcECQATe
aTgjFnqE/lQ22Rk0eGaYO80cc643BXVGafNfd9fcvwBMnk0iGX0XRsOozVt5Azil
psLBYuApa66NcVHJpCECQQDTjI2AQhFc1yRnCU/YgDnSpJVm1nASoRUnU8Jfm3Oz
uku7JUXcVpt08DFSceCEX9unCuMcT72rAQlLpdZir876
-----END RSA PRIVATE KEY-----</textarea><br/>
<p/>
<textarea id="data" placeholder="Data to encrypt" cols="65" rows="5"></textarea><br/>
<button id="encryptButton" onclick="encrypt();">Encrypt data</button>
<p/>
<textarea id="encrypted" placeholder="Encrypted data" cols="65" rows="5"></textarea><br/>
<button id="decryptButton" onclick="decrypt();">Decrypt data</button>
<p/>
<textarea id="decrypted" placeholder="Decrypted data" cols="65" rows="5"></textarea><br/>
<div id="status"></div>


</body>
</html>
